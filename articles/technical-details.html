<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Technical Details • JointODE</title>
<!-- katex math --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js" integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" crossorigin="anonymous"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js" integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script><script src="../katex-auto.js"></script><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Technical Details">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">JointODE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getting-started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/technical-details.html">Technical Details</a></li>
    <li><a class="dropdown-item" href="../articles/comparison.html">Comparison</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/signorinoy/JointODE/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Technical Details</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/signorinoy/JointODE/blob/main/vignettes/technical-details.Rmd" class="external-link"><code>vignettes/technical-details.Rmd</code></a></small>
      <div class="d-none name"><code>technical-details.Rmd</code></div>
    </div>

    
    
<p>This vignette describes the mathematical framework and computational
implementation of the JointODE model, which jointly models longitudinal
biomarker trajectories and survival outcomes through a coupled ordinary
differential equation (ODE) system.</p>
<div class="section level2">
<h2 id="model-framework">Model Framework<a class="anchor" aria-label="anchor" href="#model-framework"></a>
</h2>
<div class="section level3">
<h3 id="longitudinal-sub-model">Longitudinal Sub-Model<a class="anchor" aria-label="anchor" href="#longitudinal-sub-model"></a>
</h3>
<p>The observed biomarker measurements are modeled as: <span class="math display">
V_{ij}=m_i(T_{ij})+b_i+\varepsilon_{ij},\quad i=1,\ldots,n,\quad
j=1,\ldots,n_i
</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">V_{ij}</span>: Observed biomarker value
for subject <span class="math inline">i</span> at time <span class="math inline">T_{ij}</span>
</li>
<li>
<span class="math inline">m_i(t)</span>: True underlying biomarker
trajectory</li>
<li>
<span class="math inline">b_i\sim\mathcal{N}(0,\sigma_{b}^{2})</span>:
Subject-specific random intercept</li>
<li>
<span class="math inline">\varepsilon_{ij}\sim\mathcal{N}(0,\sigma_{e}^{2})</span>:
Measurement error</li>
</ul>
<p>The biomarker trajectory evolution is characterized by the following
second-order differential equation:</p>
<p><span class="math display">
\ddot{m}_i(t) = f\big(m_i(t), \dot{m}_i(t), \mathbf{X}_i(t), t\big)
</span></p>
<p>where <span class="math inline">f: \mathbb{R} \times \mathbb{R}
\times \mathbb{R}^p \times \mathbb{R}^+ \to \mathbb{R}</span> is a
smooth function modeling the biomarker acceleration as a function of its
current value <span class="math inline">m_i(t)</span>, velocity <span class="math inline">\dot{m}_i(t)</span>, time-varying covariates <span class="math inline">\mathbf{X}_i(t) \in \mathbb{R}^p</span>, and time
<span class="math inline">t</span>.</p>
</div>
<div class="section level3">
<h3 id="survival-sub-model">Survival Sub-Model<a class="anchor" aria-label="anchor" href="#survival-sub-model"></a>
</h3>
<p>The hazard function incorporates biomarker dynamics:</p>
<p><span class="math display">
\lambda_i(t) =
\lambda_{0}(t)\exp\left[\mathbf{W}_i^{\top}\boldsymbol{\phi}+\mathbf{m}_i(t)^{\top}\boldsymbol{\alpha}+b_{i}\right]
</span></p>
<p>where:</p>
<ul>
<li>
<span class="math inline">\lambda_{0}(t)</span>: Baseline hazard
(e.g., Weibull, piecewise constant)</li>
<li>
<span class="math inline">\mathbf{m}_i(t)=\left(m_i(t),
\dot{m}_i(t), \ddot{m}_i(t)\right)^{\top}</span>: Biomarker value and
derivatives</li>
<li>
<span class="math inline">\boldsymbol{\alpha}=(\alpha_0, \alpha_1,
\alpha_2)^{\top}</span>: Association parameters for value, velocity, and
acceleration</li>
<li>
<span class="math inline">\mathbf{W}_i</span>: Baseline covariates
with coefficients <span class="math inline">\boldsymbol{\phi}</span>
</li>
<li>
<span class="math inline">b_i</span>: Subject-specific random
intercept</li>
</ul>
</div>
<div class="section level3">
<h3 id="ode-system">ODE System<a class="anchor" aria-label="anchor" href="#ode-system"></a>
</h3>
<p>The state vector <span class="math inline">\mathbf{s}_i(t) =
(\Lambda_i(t), m_i(t), \dot{m}_i(t))^{\top}</span> evolves according
to:</p>
<p><span class="math display">
\frac{d\mathbf{s}_i}{dt} = \begin{pmatrix}
\lambda_i(t|b_i) \\
\dot{m}_i(t) \\
g(\boldsymbol{\beta}^{\top}\mathbf{Z}_i(t))
\end{pmatrix}
</span></p>
<p>with initial conditions <span class="math inline">\mathbf{s}_i(0) =
(0, m_{i0}, \dot{m}_{i0})^{\top}</span>.</p>
</div>
</div>
<div class="section level2">
<h2 id="statistical-inference">Statistical Inference<a class="anchor" aria-label="anchor" href="#statistical-inference"></a>
</h2>
<div class="section level3">
<h3 id="model-components">Model Components<a class="anchor" aria-label="anchor" href="#model-components"></a>
</h3>
<p><strong>Hazard Function:</strong> <span class="math display">\lambda_i(t|b_i) =
\exp\left[\boldsymbol{\eta}^{\top} \mathbf{B}^{(\lambda)}(t) +
\mathbf{W}_i^{\top}\boldsymbol{\phi} +
\mathbf{m}_i(t)^{\top}\boldsymbol{\alpha} + b_{i}\right]</span></p>
<p>where <span class="math inline">\mathbf{B}^{(\lambda)}(t)</span> is
the B-spline basis for baseline hazard, and <span class="math inline">\boldsymbol{\eta}</span> are the corresponding
coefficients.</p>
<p><strong>Acceleration Function:</strong> <span class="math display">g(u) = \boldsymbol{\gamma}^{\top}
\mathbf{B}^{(g)}(u), \quad u =
\boldsymbol{\beta}^{\top}\mathbf{Z}_i(t)</span></p>
<p>where <span class="math inline">\mathbf{B}^{(g)}(u)</span> is the
B-spline basis for acceleration, <span class="math inline">\boldsymbol{\gamma}</span> are the basis
coefficients, and <span class="math inline">\boldsymbol{\beta}</span>
are the single-index coefficients (constrained: <span class="math inline">\|\boldsymbol{\beta}\| = 1</span>).</p>
</div>
<div class="section level3">
<h3 id="likelihood">Likelihood<a class="anchor" aria-label="anchor" href="#likelihood"></a>
</h3>
<p>The joint likelihood for subject <span class="math inline">i</span>
integrates over the random effect:</p>
<p><span class="math display">L_i(\boldsymbol{\psi}) = \int
f(\mathbf{V}_i | b_i) \cdot f(T_i, \delta_i | b_i) \cdot f(b_i) \,
db_i</span></p>
<p>where <span class="math inline">\boldsymbol{\psi} =
(\boldsymbol{\theta}, \boldsymbol{\beta})</span>, with <span class="math inline">\boldsymbol{\theta} = (\boldsymbol{\eta},
\boldsymbol{\phi}, \boldsymbol{\alpha}, \boldsymbol{\gamma}, \sigma_e^2,
\sigma_b^2)</span>.</p>
<p><strong>Likelihood Components:</strong></p>
<ol style="list-style-type: decimal">
<li>
<strong>Longitudinal:</strong> <span class="math display">f(\mathbf{V}_i | b_i) = \prod_{j=1}^{n_i}
\mathcal{N}(V_{ij}; m_i(T_{ij}) + b_i, \sigma_e^2)</span>
</li>
<li>
<strong>Survival:</strong> <span class="math display">f(T_i,
\delta_i | b_i) = [\lambda_i(T_i|b_i)]^{\delta_i}
\exp[-\Lambda_i(T_i|b_i)]</span>
</li>
<li>
<strong>Random Effect:</strong> <span class="math display">f(b_i)
\sim \mathcal{N}(0, \sigma_b^2)</span>
</li>
</ol>
</div>
<div class="section level3">
<h3 id="em-algorithm">EM Algorithm<a class="anchor" aria-label="anchor" href="#em-algorithm"></a>
</h3>
<p>We use an Expectation-Maximization (EM) algorithm for parameter
estimation.</p>
<div class="section level4">
<h4 id="e-step-posterior-computation">E-Step: Posterior Computation<a class="anchor" aria-label="anchor" href="#e-step-posterior-computation"></a>
</h4>
<p>For each subject <span class="math inline">i</span>, compute the
posterior distribution of <span class="math inline">b_i</span> given
observed data <span class="math inline">\mathcal{O}_i</span>.</p>
<p><strong>Key simplification:</strong> The hazard and cumulative hazard
factor as:</p>
<ul>
<li><span class="math inline">\lambda_i(t|b_i) = e^{b_i}
\lambda_i(t|0)</span></li>
<li><span class="math inline">\Lambda_i(t|b_i) = e^{b_i}
\Lambda_i(t|0)</span></li>
</ul>
<p><strong>Implementation:</strong></p>
<ol style="list-style-type: decimal">
<li>
<strong>Solve baseline ODE</strong> with <span class="math inline">b_i = 0</span> to obtain <span class="math inline">m_i(t)</span>, <span class="math inline">\lambda_i(t|0)</span>, <span class="math inline">\Lambda_i(T_i|0)</span>
</li>
<li>
<strong>Find posterior mode</strong> <span class="math inline">\tilde{b}_i</span> by maximizing: <span class="math display">\ell_i(b) = b\left[\frac{S_i}{\sigma_e^2} +
\delta_i\right] - \frac{b^2}{2}\left[\frac{n_i}{\sigma_e^2} +
\frac{1}{\sigma_b^2}\right] - e^b\Lambda_i(T_i|0)</span> where <span class="math inline">S_i = \sum_j(V_{ij} - m_i(T_{ij}))</span>
</li>
<li>
<strong>Compute posterior moments</strong> via adaptive
Gauss-Hermite quadrature:
<ul>
<li>Mean: <span class="math inline">\hat{b}_i =
E[b_i|\mathcal{O}_i]</span>
</li>
<li>Variance: <span class="math inline">\hat{v}_i =
\text{Var}[b_i|\mathcal{O}_i]</span>
</li>
<li>Transform: <span class="math inline">E[e^{b_i}|\mathcal{O}_i]</span>
for survival updates</li>
</ul>
</li>
</ol>
</div>
<div class="section level4">
<h4 id="m-step-parameter-updates">M-Step: Parameter Updates<a class="anchor" aria-label="anchor" href="#m-step-parameter-updates"></a>
</h4>
<p>Maximize the expected complete-data log-likelihood:</p>
<p><span class="math display">Q(\boldsymbol{\psi}) = Q_{\text{long}} +
Q_{\text{surv}} + Q_{\text{RE}}</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">Q_{\text{long}} =
-\frac{1}{2\sigma_e^2}\sum_{i,j} [(V_{ij} - m_i(T_{ij}) - \hat{b}_i)^2 +
\hat{v}_i] - \frac{N}{2}\log(2\pi\sigma_e^2)</span></li>
<li><span class="math inline">Q_{\text{surv}} = \sum_i
[\delta_i(\log\lambda_i(T_i|0) + \hat{b}_i) -
E[e^{b_i}|\mathcal{O}_i]\Lambda_i(T_i|0)]</span></li>
<li><span class="math inline">Q_{\text{RE}} =
-\frac{1}{2\sigma_b^2}\sum_i (\hat{b}_i^2 + \hat{v}_i) -
\frac{n}{2}\log(2\pi\sigma_b^2)</span></li>
</ul>
<p><strong>Optimization Strategy:</strong></p>
<ol style="list-style-type: decimal">
<li>Update <span class="math inline">\boldsymbol{\beta}</span>:</li>
</ol>
<p><span class="math display">
\hat{\boldsymbol{\beta}} =
\arg\max_{\boldsymbol{\beta}:\|\boldsymbol{\beta}\|=1}
Q(\boldsymbol{\beta};\widehat{\boldsymbol{\theta}})
</span></p>
<ol start="2" style="list-style-type: decimal">
<li>Update <span class="math inline">\boldsymbol{\theta}</span>:</li>
</ol>
<p><span class="math display">
\hat{\boldsymbol{\theta}} = \arg\max_{\boldsymbol{\theta}}
Q(\boldsymbol{\theta};\widehat{\boldsymbol{\psi}},
\hat{\boldsymbol{\gamma}})
</span></p>
<ol start="3" style="list-style-type: decimal">
<li>Update <span class="math inline">\boldsymbol{\sigma}</span>: <span class="math display">
\sigma_e^2 = \frac{1}{N}\sum_{i,j}[(V_{ij} - m_i(T_{ij}) - \hat{b}_i)^2
+ \hat{v}_i],\quad\sigma_b^2 = \frac{1}{n}\sum_i(\hat{b}_i^2 +
\hat{v}_i)
</span>
</li>
</ol>
</div>
</div>
</div>
<div class="section level2">
<h2 id="computational-details">Computational Details<a class="anchor" aria-label="anchor" href="#computational-details"></a>
</h2>
<div class="section level3">
<h3 id="sensitivity-analysis-via-forward-method">Sensitivity Analysis via Forward Method<a class="anchor" aria-label="anchor" href="#sensitivity-analysis-via-forward-method"></a>
</h3>
<p>The M-step in the EM algorithm requires maximization of the expected
complete-data log-likelihood <span class="math inline">Q(\boldsymbol{\theta},\boldsymbol{\beta})</span>.
This optimization is performed using gradient-based methods, where the
gradient of the objective function admits a natural additive
decomposition corresponding to the longitudinal and survival
components:</p>
<p><span class="math display">\nabla Q = \nabla Q_{\text{long}} + \nabla
Q_{\text{surv}}</span></p>
<div class="section level4">
<h4 id="gradient-computation">Gradient Computation<a class="anchor" aria-label="anchor" href="#gradient-computation"></a>
</h4>
<div class="section level5">
<h5 id="parameter-vector-boldsymboltheta">Parameter Vector <span class="math inline">\boldsymbol{\theta}</span><a class="anchor" aria-label="anchor" href="#parameter-vector-boldsymboltheta"></a>
</h5>
<p>The gradient components with respect to <span class="math inline">\boldsymbol{\theta} = (\boldsymbol{\eta},
\boldsymbol{\phi}, \boldsymbol{\alpha}, \boldsymbol{\gamma})</span>
decompose as follows:</p>
<p><strong>Baseline hazard coefficients</strong> (<span class="math inline">\boldsymbol{\eta}</span>): <span class="math display">\nabla_{\boldsymbol{\eta}} Q = \sum_{i=1}^{n}
\left[\delta_i \mathbf{B}^{(\lambda)}(T_i) - E[e^{b_i}|\mathcal{O}_i]
\frac{\partial\Lambda_i(T_i|0)}{\partial\boldsymbol{\eta}}\right]</span></p>
<p><strong>Baseline covariate effects</strong> (<span class="math inline">\boldsymbol{\phi}</span>): <span class="math display">\nabla_{\boldsymbol{\phi}} Q = \sum_{i=1}^{n}
\left[\delta_i - E[e^{b_i}|\mathcal{O}_i] \cdot \Lambda_i(T_i|0)\right]
\mathbf{W}_i</span></p>
<p><strong>Association parameters</strong> (<span class="math inline">\boldsymbol{\alpha}</span>): <span class="math display">\nabla_{\boldsymbol{\alpha}} Q = \sum_{i=1}^{n}
\left[\delta_i \mathbf{m}_i(T_i) - E[e^{b_i}|\mathcal{O}_i]
\frac{\partial\Lambda_i(T_i|0)}{\partial\boldsymbol{\alpha}}\right]</span></p>
<p><strong>Acceleration spline coefficients</strong> (<span class="math inline">\boldsymbol{\gamma}</span>): <span class="math display">\nabla_{\boldsymbol{\gamma}} Q =
\sum_{i=1}^{n}\sum_{j=1}^{n_i} \frac{r_{ij}}{\sigma_e^2} \frac{\partial
m_i(T_{ij})}{\partial \boldsymbol{\gamma}} + \sum_{i=1}^{n}
\left[\delta_i \boldsymbol{\alpha}^{\top} \frac{\partial
\mathbf{m}_i(T_i)}{\partial \boldsymbol{\gamma}} -
E[e^{b_i}|\mathcal{O}_i] \frac{\partial \Lambda_i(T_i|0)}{\partial
\boldsymbol{\gamma}}\right]</span></p>
<p>where <span class="math inline">r_{ij} = V_{ij} - m_i(T_{ij}) -
\hat{b}_i</span> denotes the residual from the longitudinal model.</p>
</div>
<div class="section level5">
<h5 id="single-index-coefficients-boldsymbolbeta">Single-Index Coefficients <span class="math inline">\boldsymbol{\beta}</span><a class="anchor" aria-label="anchor" href="#single-index-coefficients-boldsymbolbeta"></a>
</h5>
<p>The gradient with respect to the constrained single-index
coefficients (<span class="math inline">\|\boldsymbol{\beta}\|=1</span>)
is:</p>
<p><span class="math display">\nabla_{\boldsymbol{\beta}} Q =
\sum_{i=1}^{n}\sum_{j=1}^{n_i} \frac{r_{ij}}{\sigma_e^2} \frac{\partial
m_i(T_{ij})}{\partial \boldsymbol{\beta}} + \sum_{i=1}^{n}
\left[\delta_i \boldsymbol{\alpha}^{\top} \frac{\partial
\mathbf{m}_i(T_i)}{\partial \boldsymbol{\beta}} -
E[e^{b_i}|\mathcal{O}_i] \frac{\partial \Lambda_i(T_i|0)}{\partial
\boldsymbol{\beta}}\right]</span></p>
</div>
</div>
<div class="section level4">
<h4 id="sensitivity-propagation">Sensitivity Propagation<a class="anchor" aria-label="anchor" href="#sensitivity-propagation"></a>
</h4>
<div class="section level5">
<h5 id="cumulative-hazard-sensitivities">Cumulative Hazard Sensitivities<a class="anchor" aria-label="anchor" href="#cumulative-hazard-sensitivities"></a>
</h5>
<p>The cumulative hazard function <span class="math inline">\Lambda_i(T_i|0)</span> depends on parameters
through the instantaneous hazard. For parameters affecting the hazard
directly, the sensitivities are computed as:</p>
<p><span class="math display">
\frac{\partial\Lambda_i(T_i|0)}{\partial\boldsymbol{\eta}}=\int_{0}^{T_i}\lambda_i(t|0)\mathbf{B}^{(\lambda)}(t)\,\mathrm{d}t,\quad
\frac{\partial\Lambda_i(T_i|0)}{\partial\boldsymbol{\alpha}}=\int_{0}^{T_i}\lambda_i(t|0)\mathbf{m}_i(t)\,\mathrm{d}t,\quad
\frac{\partial\Lambda_i(T_i|0)}{\partial\boldsymbol{\phi}}=\int_{0}^{T_i}\lambda_i(t|0)\mathbf{W}_i\,\mathrm{d}t
</span></p>
<p>For parameters affecting the trajectory <span class="math inline">m_i(t)</span>, the chain rule yields:</p>
<p><span class="math display">
\frac{\partial\Lambda_i(T_i|0)}{\partial\boldsymbol{\gamma}}=\int_{0}^{T_i}\lambda_i(t|0)\boldsymbol{\alpha}^{\top}\frac{\partial\mathbf{m}_i(t)}{\partial\boldsymbol{\gamma}}\,\mathrm{d}t,\quad\frac{\partial\Lambda_i(T_i|0)}{\partial\boldsymbol{\beta}}=\int_{0}^{T_i}\lambda_i(t|0)\boldsymbol{\alpha}^{\top}\frac{\partial\mathbf{m}_i(t)}{\partial\boldsymbol{\beta}}\,\mathrm{d}t
</span></p>
</div>
<div class="section level5">
<h5 id="trajectory-sensitivities">Trajectory Sensitivities<a class="anchor" aria-label="anchor" href="#trajectory-sensitivities"></a>
</h5>
<p>The biomarker trajectory sensitivities satisfy recursive integral
relationships that arise naturally from the hierarchical structure of
the second-order differential equation system. These sensitivities must
be computed through the forward propagation method due to the coupling
between trajectory dynamics and parameter dependencies.</p>
<p><strong>Single-index coefficients (<span class="math inline">\boldsymbol{\beta}</span>):</strong></p>
<p>The trajectory sensitivities evolve according to:</p>
<p><span class="math display">
\frac{\partial m_i(t)}{\partial \boldsymbol{\beta}} = \int_{0}^{t}
\frac{\partial\dot{m}_i(s)}{\partial \boldsymbol{\beta}}
\,\mathrm{d}s,\quad
\frac{\partial\dot{m}_i(t)}{\partial \boldsymbol{\beta}} = \int_{0}^{t}
\frac{\partial \ddot{m}_i(s)}{\partial \boldsymbol{\beta}} \,\mathrm{d}s
</span></p>
<p>where the acceleration sensitivity is given by:</p>
<p><span class="math display">
\frac{\partial \ddot{m}_i(t)}{\partial \boldsymbol{\beta}} =
\boldsymbol{\gamma}^{\top}\mathbf{B}'_g(u) \frac{\partial
u}{\partial\boldsymbol{\beta}}
</span></p>
<p>Here, <span class="math inline">u =
\boldsymbol{\beta}^{\top}\mathbf{Z}_i(t)</span> denotes the single-index
value with <span class="math inline">\mathbf{Z}_i(t) = [m_i(t),
\dot{m}_i(t), \mathbf{X}_i^{\top}(t), t]^{\top}</span> being the feature
vector. The derivative <span class="math inline">\mathbf{B}'_g(u) =
\frac{d\mathbf{B}_g(u)}{du}</span> represents the derivative of the
B-spline basis. The sensitivity of the index is:</p>
<p><span class="math display">\frac{\partial
u}{\partial\boldsymbol{\beta}} = \mathbf{Z}_i(t) +
\boldsymbol{\beta}^{\top} \frac{\partial
\mathbf{Z}_i(t)}{\partial\boldsymbol{\beta}}</span></p>
<p>where <span class="math inline">\frac{\partial
\mathbf{Z}_i(t)}{\partial\boldsymbol{\beta}} = \begin{bmatrix}
\frac{\partial m_i(t)}{\partial \boldsymbol{\beta}} \\ \frac{\partial
\dot{m}_i(t)}{\partial \boldsymbol{\beta}} \\ \mathbf{0} \\ 0
\end{bmatrix}</span> since the covariates <span class="math inline">\mathbf{X}_i(t)</span> and time <span class="math inline">t</span> do not depend on <span class="math inline">\boldsymbol{\beta}</span>.</p>
<p><strong>Acceleration spline coefficients (<span class="math inline">\boldsymbol{\gamma}</span>):</strong></p>
<p>Similarly, the sensitivities with respect to <span class="math inline">\boldsymbol{\gamma}</span> follow:</p>
<p><span class="math display">
\frac{\partial m_i(t)}{\partial \boldsymbol{\gamma}} = \int_{0}^{t}
\frac{\partial\dot{m}_i(s)}{\partial \boldsymbol{\gamma}}
\,\mathrm{d}s,\quad
\frac{\partial\dot{m}_i(t)}{\partial \boldsymbol{\gamma}} = \int_{0}^{t}
\frac{\partial \ddot{m}_i(s)}{\partial \boldsymbol{\gamma}}
\,\mathrm{d}s
</span></p>
<p>The acceleration sensitivity is:</p>
<p><span class="math display">
\frac{\partial \ddot{m}_i(t)}{\partial \boldsymbol{\gamma}} =
\mathbf{B}_g(u) + \boldsymbol{\gamma}^{\top}\mathbf{B}'_g(u)
\frac{\partial u}{\partial \boldsymbol{\gamma}}
</span></p>
<p>This expression reveals two distinct contributions: - <strong>Direct
effect</strong>: <span class="math inline">\mathbf{B}_g(u)</span>
captures the explicit linear dependence of the acceleration function on
<span class="math inline">\boldsymbol{\gamma}</span> - <strong>Indirect
effect</strong>: <span class="math inline">\boldsymbol{\gamma}^{\top}\mathbf{B}'_g(u)
\frac{\partial u}{\partial \boldsymbol{\gamma}}</span> accounts for the
implicit dependence through the feedback of trajectory states</p>
<p>The index sensitivity is:</p>
<p><span class="math display">\frac{\partial u}{\partial
\boldsymbol{\gamma}} = \boldsymbol{\beta}^{\top} \frac{\partial
\mathbf{Z}_i(t)}{\partial \boldsymbol{\gamma}} =
\boldsymbol{\beta}^{\top} \begin{bmatrix}
\frac{\partial m_i(t)}{\partial \boldsymbol{\gamma}} \\ \frac{\partial
\dot{m}_i(t)}{\partial \boldsymbol{\gamma}} \\ \mathbf{0} \\ 0
\end{bmatrix}</span></p>
<p>This dual dependence structure—explicit through the linear
combination and implicit through the state feedback—is a key feature of
the single-index acceleration model.</p>
</div>
</div>
<div class="section level4">
<h4 id="computational-implementation-via-augmented-ode-systems">Computational Implementation via Augmented ODE Systems<a class="anchor" aria-label="anchor" href="#computational-implementation-via-augmented-ode-systems"></a>
</h4>
<p>The practical computation of these gradients necessitates solving
augmented ordinary differential equation systems that simultaneously
evolve both the primary state variables and their parameter
sensitivities. This approach, known as the forward sensitivity method,
extends the original three-dimensional state space to include
sensitivity trajectories.</p>
<p><strong>Augmented system for <span class="math inline">\boldsymbol{\theta}</span> components:</strong></p>
<p><span class="math display">\frac{d}{dt}\begin{bmatrix}
\Lambda_i \\ m_i \\ \dot{m}_i \\ \partial\Lambda_{\eta,i} \\
\partial\Lambda_{\alpha,i} \\ \partial m_{i,\gamma} \\
\partial\dot{m}_{i,\gamma} \\ \partial\Lambda_{\gamma,i}
\end{bmatrix} = \begin{bmatrix}
\lambda_i(t|0) \\
\dot{m}_i(t) \\
g(\boldsymbol{\beta}^{\top}\mathbf{Z}_i(t))  \\
\mathbf{B}^{(\lambda)}(t) \lambda_i(t|0) \\
\mathbf{m}_i(t) \lambda_i(t|0) \\
\partial\dot{m}_{i,\gamma} \\
\mathbf{B}_g(u) + \boldsymbol{\gamma}^{\top}\mathbf{B}'_g(u) \cdot
\frac{\partial u}{\partial \boldsymbol{\gamma}} \\
\boldsymbol{\alpha}^{\top}\frac{\partial\mathbf{m}_i(t)}{\partial\boldsymbol{\gamma}}
\lambda_i(t|0)
\end{bmatrix}</span></p>
<p><strong>Augmented system for <span class="math inline">\boldsymbol{\beta}</span>
sensitivities:</strong></p>
<p><span class="math display">\frac{d}{dt}\begin{bmatrix}
\Lambda_i \\ m_i \\ \dot{m}_i \\ \partial m_{i,\beta} \\
\partial\dot{m}_{i,\beta} \\ \partial\Lambda_{\beta,i}
\end{bmatrix} = \begin{bmatrix}
\lambda_i(t|0) \\
\dot{m}_i(t) \\
g(\boldsymbol{\beta}^{\top}\mathbf{Z}_i(t)) \\
\partial \dot{m}_{i,\beta} \\
\boldsymbol{\gamma}^{\top}\mathbf{B}'_g(u) \cdot \frac{\partial
u}{\partial\boldsymbol{\beta}} \\
\boldsymbol{\alpha}^{\top}\frac{\partial\mathbf{m}_i(t)}{\partial\boldsymbol{\beta}}
\cdot \lambda_i(t|0)
\end{bmatrix}</span></p>
<p>Here, <span class="math inline">\partial\Lambda_{\eta,i}</span>,
<span class="math inline">\partial\Lambda_{\alpha,i}</span>, <span class="math inline">\partial\Lambda_{\gamma,i}</span>, and <span class="math inline">\partial\Lambda_{\beta,i}</span> denote the
cumulative hazard sensitivities with respect to the corresponding
parameter groups, while <span class="math inline">\frac{\partial
u}{\partial\boldsymbol{\beta}}</span> follows the recursive relationship
defined previously. These augmented systems must be integrated from
<span class="math inline">t=0</span> to <span class="math inline">t=T_i</span> for each subject to obtain the complete
sensitivity information required for gradient computation.</p>
</div>
</div>
<div class="section level3">
<h3 id="adjoint-sensitivity-analysis">Adjoint Sensitivity Analysis<a class="anchor" aria-label="anchor" href="#adjoint-sensitivity-analysis"></a>
</h3>
<p>While the forward sensitivity approach above requires solving
augmented ODE systems with dimension proportional to the number of
parameters, the adjoint method offers a more efficient alternative for
gradient computation, especially when the number of parameters is
large.</p>
<div class="section level4">
<h4 id="adjoint-method-formulation">Adjoint Method Formulation<a class="anchor" aria-label="anchor" href="#adjoint-method-formulation"></a>
</h4>
<p>For a general objective function <span class="math inline">J</span>
that depends on the ODE solution: <span class="math display">J =
\int_0^T L(t, \mathbf{s}(t), \boldsymbol{\theta}) \, dt +
G(\mathbf{s}(T), \boldsymbol{\theta})</span></p>
<p>where <span class="math inline">\mathbf{s}(t)</span> satisfies the
ODE system <span class="math inline">\dot{\mathbf{s}} = f(t, \mathbf{s},
\boldsymbol{\theta})</span>, the gradient with respect to parameters
<span class="math inline">\boldsymbol{\theta}</span> can be computed by
solving the adjoint equation backward in time:</p>
<p><span class="math display">\frac{d\boldsymbol{\lambda}}{dt} =
-\left(\frac{\partial f}{\partial \mathbf{s}}\right)^T
\boldsymbol{\lambda} - \left(\frac{\partial L}{\partial
\mathbf{s}}\right)^T</span></p>
<p>with terminal condition: <span class="math display">\boldsymbol{\lambda}(T) = \left(\frac{\partial
G}{\partial \mathbf{s}}\right)^T_{t=T}</span></p>
<p>The gradient is then: <span class="math display">\frac{dJ}{d\boldsymbol{\theta}} = \int_0^T
\left[\boldsymbol{\lambda}^T \frac{\partial f}{\partial
\boldsymbol{\theta}} + \frac{\partial L}{\partial
\boldsymbol{\theta}}\right] dt + \frac{\partial G}{\partial
\boldsymbol{\theta}}</span></p>
</div>
<div class="section level4">
<h4 id="application-to-jointode-model">Application to JointODE Model<a class="anchor" aria-label="anchor" href="#application-to-jointode-model"></a>
</h4>
<p>For our model, the objective function components are:</p>
<p><strong>Longitudinal contribution:</strong> <span class="math display">J_{\text{long}} = \sum_{j=1}^{n_i}
\frac{1}{2\sigma_e^2} (V_{ij} - m_i(T_{ij}) - \hat{b}_i)^2</span></p>
<p><strong>Survival contribution:</strong> <span class="math display">J_{\text{surv}} = -\delta_i \log \lambda_i(T_i|0) +
E[e^{b_i}|\mathcal{O}_i] \Lambda_i(T_i|0)</span></p>
<p>The adjoint equations for computing gradients with respect to <span class="math inline">\boldsymbol{\beta}</span> become:</p>
<p><span class="math display">\frac{d\boldsymbol{\lambda}}{dt} =
-\begin{bmatrix}
0 &amp; 0 &amp; 0 \\
0 &amp; -\frac{\partial g}{\partial m} \lambda_3 - \alpha_0 \lambda_1
\lambda_i(t|0) &amp; -\lambda_2 - \frac{\partial g}{\partial \dot{m}}
\lambda_3 - \alpha_1 \lambda_1 \lambda_i(t|0) \\
0 &amp; 0 &amp; 0
\end{bmatrix} \boldsymbol{\lambda} - \boldsymbol{r}(t)</span></p>
<p>where <span class="math inline">\boldsymbol{r}(t)</span> represents
the contribution from observation times: <span class="math display">\boldsymbol{r}(t) = \sum_{j: T_{ij} = t}
\frac{1}{\sigma_e^2} (V_{ij} - m_i(t) - \hat{b}_i) \begin{bmatrix} 0 \\
1 \\ 0 \end{bmatrix} \delta(t - T_{ij})</span></p>
<p>with terminal condition at <span class="math inline">t = T_i</span>:
<span class="math display">\boldsymbol{\lambda}(T_i) =
\frac{\partial}{\partial \mathbf{s}} \left[-\delta_i \log
\lambda_i(T_i|0) + E[e^{b_i}|\mathcal{O}_i]
\Lambda_i(T_i|0)\right]_{t=T_i} = \begin{bmatrix}
E[e^{b_i}|\mathcal{O}_i] \\
-\delta_i \frac{\alpha_0}{\lambda_i(T_i|0)} \\
-\delta_i \frac{\alpha_1}{\lambda_i(T_i|0)}
\end{bmatrix}</span></p>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ziyang Gong.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>

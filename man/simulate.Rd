% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/simulate.R
\name{simulate}
\alias{simulate}
\title{Simulate Data from a Joint Ordinary Differential Equation Model}
\usage{
simulate(
  n_subjects = 200,
  shared_sd = 0.1,
  longitudinal = list(xi = 0.707, period = 5, k = 1, excitation = list(offset = 0,
    covariates = c(x1 = 0.8, x2 = -0.5)), initial = list(offset = -3, covariates = c(x1 =
    0.1, x2 = -0.1), random_coef = 0), error_sd = 0.1, n_measurements = 10),
  survival = list(baseline = list(type = "weibull", shape = 1.5, scale = 8), value = 0.3,
    slope = 1, covariates = c(w1 = 0.4, w2 = -0.6)),
  covariates = list(x1 = list(type = "normal", mean = 0, sd = 1), x2 = list(type =
    "normal", mean = 0, sd = 1), w1 = list(type = "normal", mean = 0, sd = 1), w2 =
    list(type = "binary", prob = 0.5)),
  maxt = 10,
  seed = 42
)
}
\arguments{
\item{n_subjects}{Integer specifying the number of subjects to simulate
(default: 200)}

\item{shared_sd}{Positive scalar defining the standard deviation of the
shared random effects, \eqn{\sigma_b} (default: 0.1)}

\item{longitudinal}{List specifying the longitudinal sub-model parameters:
\describe{
\item{xi}{Damping ratio \eqn{\xi} controlling the oscillation decay.
Values: \eqn{\xi < 1} (underdamped), \eqn{\xi = 1} (critically damped),
\eqn{\xi > 1} (overdamped) (default: 0.707, slightly underdamped)}
\item{period}{Natural period \eqn{T} of oscillation in time units,
related to natural frequency as \eqn{\omega = 2\pi/T} (default: 5)}
\item{k}{Excitation amplitude scaling factor \eqn{k} that modulates
the strength of external forcing (default: 1.0)}
\item{excitation}{List specifying external forcing parameters:
\describe{
\item{offset}{Constant excitation term \eqn{f_0} (default: 0.0)}
\item{covariates}{Named vector of covariate effects
\eqn{\boldsymbol{\beta}_{exc}} on excitation
(default: c(x1 = 0.8, x2 = -0.5))}
}
}
\item{initial}{List specifying initial condition parameters:
\describe{
\item{offset}{Baseline initial biomarker value \eqn{\mu_0}
(default: -3.0)}
\item{covariates}{Named vector of covariate effects
\eqn{\boldsymbol{\beta}_{init}} on initial biomarker level
(default: c(x1 = 0.1, x2 = -0.1))}
\item{random_coef}{Scaling coefficient \eqn{\psi} for random effect
influence on initial conditions (default: 0.0)}
}
}
\item{error_sd}{Standard deviation \eqn{\sigma_{\epsilon}} of the
measurement error process (default: 0.1)}
\item{n_measurements}{Number of longitudinal measurements per subject
(default: 10)}
}}

\item{survival}{List specifying the survival sub-model parameters:
\describe{
\item{baseline}{List defining the Weibull baseline hazard function:
\describe{
\item{type}{Character string specifying the baseline hazard type
(currently only "weibull" is supported)}
\item{shape}{Weibull shape parameter \eqn{\kappa > 0}
(default: 1.5)}
\item{scale}{Weibull scale parameter \eqn{\lambda > 0}
(default: 8.0)}
}
}
\item{value}{Association parameter \eqn{\alpha_1} linking current
biomarker value to hazard (default: 0.3)}
\item{slope}{Association parameter \eqn{\alpha_2} linking biomarker
velocity to hazard (default: 1.0)}
\item{covariates}{Named vector of regression coefficients
\eqn{\boldsymbol{\phi}} for survival covariates
(default: c(w1 = 0.4, w2 = -0.6))}
}}

\item{covariates}{List defining the distributions of baseline covariates:
\describe{
\item{x1}{List with \code{type = "normal"}, \code{mean = 0},
\code{sd = 1} for standardized continuous covariate (longitudinal)}
\item{x2}{List with \code{type = "normal"}, \code{mean = 0},
\code{sd = 1} for standardized continuous covariate (longitudinal)}
\item{w1}{List with \code{type = "normal"}, \code{mean = 0},
\code{sd = 1} for standardized continuous covariate (survival)}
\item{w2}{List with \code{type = "binary"} and \code{prob = 0.5}
for binary covariate (survival)}
}}

\item{maxt}{Positive scalar specifying the maximum follow-up time in the
study (default: 10 time units)}

\item{seed}{Integer seed for random number generation to ensure
reproducibility (default: 42)}
}
\value{
A list containing three components:
\describe{
\item{\code{longitudinal_data}}{Data frame comprising longitudinal
observations with columns:
\itemize{
\item \code{id}: Subject identifier (integer)
\item \code{time}: Observation time point (numeric)
\item \code{observed}: Measured biomarker value including
measurement error, \eqn{y_{ij}}
\item \code{biomarker}: True underlying biomarker value,
\eqn{m_i(t_{ij})}
\item \code{velocity}: First derivative of the biomarker trajectory,
\eqn{\dot{m}_i(t_{ij})}
\item \code{acceleration}: Second derivative of the biomarker
trajectory, \eqn{\ddot{m}_i(t_{ij})}
\item \code{x1}, \code{x2}, \code{x3}:
Time-invariant covariates
}
}
\item{\code{survival_data}}{Data frame containing time-to-event data
with columns:
\itemize{
\item \code{id}: Subject identifier
\item \code{time}: Observed event or censoring time, \eqn{T_i}
\item \code{status}: Event indicator, \eqn{\delta_i}
(1 = event observed, 0 = censored)
\item \code{b}: Realized subject-specific random effect, \eqn{b_i}
\item \code{x1}, \code{x2}, \code{x3}:
Baseline covariate values
}
}
\item{\code{state}}{An \eqn{n \times 2} matrix containing initial states
\eqn{[m_i(0), \dot{m}_i(0)]} for each subject}
}
}
\description{
Generates synthetic longitudinal and time-to-event data under a joint
modeling framework where the longitudinal biomarker trajectory follows a
damped harmonic oscillator model (second-order ODE), and the survival
process is associated with the biomarker dynamics through shared random
effects and trajectory-dependent hazard functions. The biomarker dynamics
are parameterized using physically interpretable parameters: damping ratio,
natural period, and excitation amplitude.
}
\details{
The simulation framework implements a joint model comprising longitudinal
and survival sub-models linked through shared random effects and
trajectory-dependent associations.

\subsection{Longitudinal Sub-model}{
The biomarker trajectory \eqn{m_i(t)} for subject \eqn{i} follows a damped
harmonic oscillator with external forcing:
\deqn{\ddot{m}_i(t) + 2\xi\omega\dot{m}_i(t) + \omega^2 m_i(t) =
  k \omega^2 [f_0 + \mathbf{X}_i^T\boldsymbol{\beta}_{exc}]}
where:
\itemize{
\item \eqn{\omega = 2\pi/T} is the natural angular frequency
\item \eqn{\xi} is the damping ratio determining oscillation behavior
\item \eqn{k} scales the excitation amplitude
\item \eqn{f_0} is the constant excitation term
\item \eqn{\mathbf{X}_i} contains time-invariant covariates
\item \eqn{\boldsymbol{\beta}_{exc}} represents covariate effects on excitation
}

Initial conditions are specified as:
\itemize{
\item \eqn{m_i(0) = \mu_0 + \mathbf{X}_i^T\boldsymbol{\beta}_{init} + \psi b_i}
\item \eqn{\dot{m}_i(0) = 0} (zero initial velocity)
}

The observed longitudinal measurements incorporate additive Gaussian noise:
\deqn{y_{ij} = m_i(t_{ij}) + b_i + \epsilon_{ij}}
where \eqn{\epsilon_{ij} \sim \mathcal{N}(0, \sigma_\epsilon^2)}
represents independent measurement error.
}

\subsection{Survival Sub-model}{
The instantaneous hazard function incorporates both current biomarker value
and velocity:
\deqn{\lambda_i(t) = \lambda_0(t)\exp(\alpha_1 m_i(t) + \alpha_2\dot{m}_i(t)
 + \mathbf{W}_i^T\boldsymbol{\phi} + b_i)}
where:
\itemize{
\item \eqn{\lambda_0(t)} denotes the Weibull baseline hazard:
\eqn{\lambda_0(t) = (k/\lambda)(t/\lambda)^{k-1}}
\item \eqn{\alpha_1} quantifies the association with current biomarker
value
\item \eqn{\alpha_2} quantifies the association with biomarker velocity
\item \eqn{\mathbf{W}_i} contains baseline covariates
\item \eqn{\boldsymbol{\phi}} represents covariate effects on survival
}
}

\subsection{Random Effects Structure}{
Subject-specific random effects \eqn{b_i \sim \mathcal{N}(0, \sigma_b^2)}
induce correlation
between the longitudinal and survival processes through:
\itemize{
\item Initial biomarker level via \eqn{m_i(0)}
\item Hazard function via the frailty term
\item Longitudinal observations via additive shift
}
}
}
\examples{
# Generate a small dataset with default parameters
sim_data <- simulate(n_subjects = 50, seed = 123)

# Examine the structure of generated data
str(sim_data)

\dontrun{
# Customized simulation with underdamped oscillator
sim_data <- simulate(
  n_subjects = 200,
  longitudinal = list(
    xi = 0.3,          # Low damping (more oscillatory)
    period = 3,        # Faster oscillations
    k = 1.5,           # Stronger excitation
    excitation = list(
      offset = 0.5,
      covariates = c(x1 = 1.0, x2 = -0.3)
    ),
    initial = list(
      offset = 0.0,    # Start at equilibrium
      covariates = c(x1 = 0.5, x2 = -0.2),
      random_coef = 0.5
    ),
    error_sd = 0.2     # Moderate measurement error
  )
)

# Overdamped system (no oscillations)
sim_data_overdamped <- simulate(
  n_subjects = 100,
  longitudinal = list(
    xi = 2.0,          # Overdamped (exponential decay)
    period = 10,       # Slow dynamics
    k = 0.5,           # Weak excitation
    excitation = list(
      offset = -1.0,
      covariates = c(x1 = 0.2, x2 = 0.1)
    )
  )
)
}
}
\concept{data-simulation}

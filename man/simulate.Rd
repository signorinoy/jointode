% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/simulate.R
\name{simulate}
\alias{simulate}
\title{Simulate Joint ODE Model Data}
\usage{
simulate(
  n = 200,
  alpha = c(0.5, 0, 0.3),
  beta = c(-1, -2, 2, 1, 0.5),
  phi = c(0.4, -0.6),
  weibull_shape = 1.5,
  weibull_scale = 8,
  sigma_b = 0.1,
  sigma_e = 0.1,
  seed = 42,
  verbose = FALSE
)
}
\arguments{
\item{n}{Integer. Number of subjects to simulate. Larger cohorts provide
more stable parameter estimates (default: 200).}

\item{alpha}{Numeric vector of length 3. Association parameters quantifying
how trajectory features influence survival hazard:
\code{[biomarker, velocity, acceleration]}.
Positive values indicate increased risk (default: c(0.5, 0.0, 0.3)).}

\item{beta}{Numeric vector governing ODE dynamics (length 5). Controls
biomarker trajectory evolution: \code{[biomarker, velocity,
  x1, x2, time]} (default: c(-1, -2, 2, 1, 0.5)).}

\item{phi}{Numeric vector of length 2. Baseline covariate effects modulating
survival hazard independently of biomarker dynamics: \code{[w1, w2]}
(default: c(0.4, -0.6)).}

\item{weibull_shape}{Numeric. Weibull shape parameter (\eqn{\kappa})
characterizing baseline hazard evolution. Values > 1 yield increasing
hazard (aging effect), < 1 decreasing hazard (selection effect), =
1 constant hazard (exponential) (default: 1.5).}

\item{weibull_scale}{Numeric. Weibull scale parameter (\eqn{\theta})
determining the characteristic event time. Larger values shift the
hazard curve rightward (default: 8).}

\item{sigma_b}{Numeric. Standard deviation of subject-specific random effects
capturing unobserved heterogeneity. Larger values increase between-subject
variability in both trajectories and hazards (default: 0.1).}

\item{sigma_e}{Numeric. Measurement error standard deviation reflecting
assay precision and biological fluctuations. Smaller values indicate
more reliable biomarker measurements (default: 0.1).}

\item{seed}{Integer. Random seed ensuring reproducible simulations.
Essential for method validation and comparison studies (default: 42).}

\item{verbose}{Logical. Display informative progress messages during
simulation workflow (default: FALSE).}
}
\value{
A list containing two complementary datasets:
\describe{
\item{longitudinal_data}{Data frame with longitudinal measurements:
\itemize{
\item \code{id}: Subject identifier
\item \code{time}: Measurement time
\item \code{v}: Observed biomarker value incorporating latent
trajectory, random effect, and measurement error
\item \code{x1}: First longitudinal covariate (standardized)
\item \code{x2}: Second longitudinal covariate (standardized)
\item \code{biomarker}: True latent biomarker trajectory value
\item \code{velocity}: True latent biomarker velocity value
\item \code{acceleration}: True latent biomarker acceleration value
}}
\item{survival_data}{Data frame with survival outcomes:
\itemize{
\item \code{id}: Subject identifier
\item \code{time}: Observed event/censoring time
\item \code{status}: Event indicator (1 = event, 0 = censored)
\item \code{w1}: First survival covariate (standardized)
\item \code{w2}: Second survival covariate (standardized)
\item \code{b}: Shared random effect
}}
}
}
\description{
Generates synthetic data from a sophisticated joint modeling framework that
seamlessly integrates longitudinal biomarker trajectories with survival
outcomes through ordinary differential equations (ODEs). This simulation
engine produces realistic clinical trial datasets where complex biomarker
dynamics govern event hazards via shared random effects and trajectory
features, capturing the intricate interplay between disease progression
and time-to-event processes.
}
\details{
\strong{Mathematical Framework}

The simulation orchestrates a sophisticated joint model architecture
comprising two intricately coupled components:

\strong{1. Longitudinal Dynamics}

Biomarker evolution is governed by a second-order linear ODE system
that captures temporal dynamics:
\deqn{\ddot{m}_i(t) = \boldsymbol{\beta}^{\top} \mathbf{Z}_i(t)}

where:
\itemize{
\item \eqn{m_i(t)}: Latent biomarker trajectory for subject \eqn{i}
\item \eqn{\mathbf{Z}_i(t) = [m_i(t), \dot{m}_i(t), X_1, X_2, t]^{\top}}:
State vector (5-dimensional)
\item \eqn{\boldsymbol{\beta}}: Parameter vector governing homeostatic
feedback, damping forces, and external influences
}

Observed measurements arise from a hierarchical structure incorporating
both systematic and stochastic components:
\deqn{V_{ij} = m_i(T_{ij}) + b_i + \varepsilon_{ij}}

where \eqn{b_i \sim N(0, \sigma_b^2)} captures subject-specific deviations
and \eqn{\varepsilon_{ij} \sim N(0, \sigma_e^2)} represents measurement
variability.

\strong{2. Survival Process}

The instantaneous hazard function elegantly links biomarker dynamics
to event risk through a multiplicative model:
\deqn{\lambda_i(t|b_i) = \lambda_0(t) \exp[\boldsymbol{\alpha}^{\top}
  \mathbf{m}_i(t) + \mathbf{W}_i^{\top} \boldsymbol{\phi} + b_i]}

where:
\itemize{
\item \eqn{\lambda_0(t) = (\kappa/\theta)(t/\theta)^{\kappa-1}}:
Weibull baseline hazard capturing population-level risk evolution
\item \eqn{\mathbf{m}_i(t) = [m_i(t), \dot{m}_i(t), \ddot{m}_i(t)]^{\top}}:
Comprehensive trajectory feature vector
\item \eqn{\mathbf{W}_i}: Time-invariant baseline characteristics
\item \eqn{b_i}: Shared random effect inducing correlation between
longitudinal and survival processes
}

\strong{Simulation Workflow}

The data generation proceeds through a carefully orchestrated pipeline:

\enumerate{
\item \strong{ODE Integration}: Numerical solution of the coupled ODE
system using adaptive Runge-Kutta methods with automatic step size
control for optimal accuracy-efficiency tradeoff
\item \strong{Event Time Generation}: Sophisticated sampling from the
conditional hazard distribution via the \code{simsurv} engine,
accounting for complex time-varying covariates
\item \strong{Censoring Mechanism}: Realistic administrative censoring
uniformly distributed between the 50th and 95th percentiles of
event times, mimicking clinical trial follow-up patterns
\item \strong{Visit Scheduling}: Adaptive measurement protocols with
higher frequency during critical periods (quarterly initially,
semi-annual subsequently) and stochastic 10\% missingness
}

\strong{Parameter Interpretation Guide}

\itemize{
\item \strong{Trajectory Dynamics (\code{beta})}:
\itemize{
\item \code{beta[1]}: Homeostatic feedback strength (negative values
promote stability)
\item \code{beta[2]}: Damping coefficient controlling oscillation
suppression
\item \code{beta[3-4]}: Sensitivity to longitudinal covariates
\item \code{beta[5]}: Time trend capturing systematic changes
}
\item \strong{Hazard Association (\code{alpha})}:
\itemize{
\item \code{alpha[1]}: Current biomarker value effect (positive
indicates deleterious biomarker)
\item \code{alpha[2]}: Velocity effect capturing prognostic value
of trajectory direction
\item \code{alpha[3]}: Acceleration effect reflecting stability
importance (negative suggests protective stability)
}
}
}
\note{
\itemize{
\item Visit schedules intelligently adapt to individual follow-up
durations, balancing information gain with practical constraints
\item Progress reporting can be silenced via \code{verbose = FALSE}
for batch simulations
}
}
\examples{
# Basic usage with default parameters
sim <- simulate()
str(sim)

# Check data characteristics
cat("Event rate:", mean(sim$survival_data$status), "\n")
cat(
  "Observations per subject:",
  nrow(sim$longitudinal_data) / nrow(sim$survival_data), "\n"
)

# Visualize trajectories with survival information
library(ggplot2)
library(dplyr)

# Select subjects with different outcomes
plot_data <- sim$longitudinal_data \%>\%
  left_join(sim$survival_data[, c("id", "time", "status")],
    by = "id", suffix = c("", "_event")
  ) \%>\%
  filter(id \%in\% sample(unique(id), 9))

ggplot(plot_data, aes(x = time, y = v)) +
  geom_line(aes(color = factor(status)), alpha = 0.7) +
  geom_point(aes(color = factor(status)), size = 1) +
  geom_vline(aes(xintercept = time_event),
    linetype = "dashed", alpha = 0.5
  ) +
  facet_wrap(~id, scales = "free_y", ncol = 3) +
  scale_color_manual(
    values = c("0" = "blue", "1" = "red"), labels = c("Censored", "Event")
  ) +
  theme_minimal() +
  labs(
    x = "Time (years)", y = "Biomarker Value", color = "Outcome",
    title = "Simulated Longitudinal Trajectories"
  )

}
\seealso{
\code{\link[simsurv]{simsurv}} for the underlying survival simulation
\code{\link[deSolve]{ode}} for ODE integration details
}
\concept{data-simulation}
